<!DOCTYPE html>
<!--
    LucidEd - Lucid Edit, a browser-based text editor
    Copyright (C) 2012  David Duong

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LucidEd - Lucid Edit, a browser-based text editor</title>

    <link rel="stylesheet" href="lib/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="style/style.css">

<script type="text/javascript">
<!--
var pathname = location.pathname;
var dojoConfig = {
	async: true,
	isDebug: true,
	packages: [{
		name: "lucided",
		location: pathname.replace(/\/[^/]*$/, '/lib/lucided')
	},{
		name: "codemirror",
		location: pathname.replace(/\/[^/]*$/, '/lib/codemirror')
	},{
		name: "pagedown",
		location: "//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0"
	},{
		name: "coffee-script",
		location: "//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.3.3"
	},{
		name: "log4javascript",
		location: "//cdnjs.cloudflare.com/ajax/libs/log4javascript/1.4.3"
	}]
};
// -->
</script>
<!--
    <link rel="stylesheet" href="lib/dijit/themes/nihilo/nihilo.css">
    <script src="lib/dojo/dojo.js"></script>
-->

    <script src="//ajax.googleapis.com/ajax/libs/dojo/1.8.2/dojo/dojo.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/dojo/1.8.2/dijit/themes/nihilo/nihilo.css">
<script type="text/javascript">
<!--
// Initialize localStorage['lucid_init'] which is used as a customizable init script
// See http://en.wikipedia.org/wiki/Web_storage
if (!('lucid_init' in window.localStorage))
	window.localStorage['lucid_init'] = "load 'README.markdown'";

require([
    "dojo/keys",
    "dojo/on",
    "lucided/REPL",
    "lucided/decorate",
    "codemirror/lib/codemirror",
    "dojo/domReady!"
], function (keys, on, REPL, decorate) {
    "use strict";
    // Custom dijit providing the bottom tabs + console
    var repl = new REPL({id: "repl"});
    document.body.appendChild(repl.domNode);
    repl.startup();

    // CodeMirror editor
    var editor = CodeMirror(document.body, {
        lineNumbers: true,
        autofocus: true
    });

    // Bind ESCAPE key to opening / closing console
    on(document.body, "keydown", function (evt) {
        if (evt.keyCode === keys.ESCAPE) {
            var select = (repl.tabContainer.selectedChildWidget != repl.hideTab)? repl.hideTab: repl.consoleTabContents;
	        repl.tabContainer.selectChild(select);
        }
    }); 

    // Hide console when focus is lost
    on(repl, "blur", function () {
        repl.tabContainer.selectChild(repl.hideTab);
    });

    // Give console input focus when console tab is selected
    on(repl.hideTab, "show", function () {
        editor.focus();
    });

	// Decorate the window object to provide convenience methods/properties
	var decorated = decorate(window, editor, repl);

	// Show the help tab
	decorated.help();

	// Execute the command displaying results in REPL dijit
	decorated.cseval(localStorage.lucid_init);
	repl.tabContainer.selectChild(repl.hideTab);
});
// -->
</script>

</head>
<body class="nihilo">
</body>
</html>
